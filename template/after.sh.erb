<% if context.cluster == "nesi_tdc_hpc" -%>
# Wait for the RStudio Server to start
echo "Waiting for RStudio Server to open port ${port}..."
echo "TIMING - Starting wait at: $(date)"
if wait_until_port_used "${host}:${port}" 240; then
  echo "Discovered RStudio Server listening on port ${port}!"
  echo "TIMING - Wait ended at: $(date)"
else
  echo "Timed out waiting for RStudio Server to open port ${port}! on $(date)"
  echo "TIMING - Wait ended at: $(date)"
  clean_up 1
fi
sleep 2
<% end -%>
